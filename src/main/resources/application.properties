sessions=20223,20231,20232
discord.token=${DISCORD_TOKEN}

# CORS Configuration - comma-separated list of allowed origins
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://horairets.emmanuelcoulombe.dev}

# Database Configuration
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${HIKARI_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${HIKARI_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${HIKARI_MAX_LIFETIME:1800000}
spring.datasource.hikari.leak-detection-threshold=${HIKARI_LEAK_DETECTION:60000}
spring.datasource.hikari.pool-name=HoraireETSPool
spring.datasource.hikari.auto-commit=false

# JPA/Hibernate Configuration
# Security: Disable SQL logging in production (use proper logging framework instead)
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${SPRING_JPA_FORMAT_SQL:false}

# Hibernate DDL mode: 'update' creates/updates tables automatically
# Use 'validate' or 'none' in production for safety
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_DDL_AUTO:update}

# JPA Naming Strategy
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl

# JPA Properties
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=${SPRING_JPA_BATCH_SIZE:20}
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.generate_statistics=${SPRING_JPA_STATISTICS:false}
spring.jpa.open-in-view=false
# Both properties are required: HikariCP disables autoCommit, Hibernate is informed it's already disabled
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# Server Configuration
server.port=${SERVER_PORT:8080}
server.address=${SERVER_ADDRESS:0.0.0.0}
server.servlet.context-path=/
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# Server Timeouts (milliseconds)
server.connection-timeout=${SERVER_CONNECTION_TIMEOUT:20000}
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
server.tomcat.max-keep-alive-requests=100

# Compression
server.compression.enabled=${SERVER_COMPRESSION_ENABLED:true}
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css
server.compression.min-response-size=1024

# Request size limits to prevent DoS attacks
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.enabled=true
server.max-http-header-size=8192
server.max-http-form-post-size=10MB

# Disable unnecessary features
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false
server.error.path=/error

# Enable throwing NoHandlerFoundException for 404s (to handle in custom error controller)
# This will throw exceptions for unmapped routes (API endpoints)
spring.mvc.throw-exception-if-no-handler-found=true

# Actuator Configuration for Prometheus Monitoring
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.show-details=when-authorized
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true

# Enable JVM metrics
management.metrics.enable.jvm=true
management.metrics.enable.http.server.requests=true
management.metrics.enable.hikaricp=true
management.metrics.enable.process.files=true
management.metrics.enable.system=true

# Metrics distribution configuration
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=10ms,50ms,100ms,200ms,500ms,1s,2s,5s
management.metrics.tags.application=horaire-ets
management.metrics.tags.environment=${ENVIRONMENT:production}

# HikariCP metrics
management.metrics.hikaricp.enabled=true

# SpringDoc OpenAPI (Swagger) Configuration
# Swagger is enabled by default
# To disable: Set SPRINGDOC_SWAGGER_UI_ENABLED=false
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=${SPRINGDOC_SWAGGER_UI_ENABLED:true}
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.swagger-ui.filter=true
springdoc.swagger-ui.displayRequestDuration=true
springdoc.swagger-ui.deepLinking=true

# JSON/Jackson Configuration
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.default-property-inclusion=non_null
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSSZ
spring.jackson.time-zone=UTC

# Async/Task Execution Configuration
spring.task.execution.pool.core-size=${TASK_EXECUTOR_CORE_SIZE:5}
spring.task.execution.pool.max-size=${TASK_EXECUTOR_MAX_SIZE:10}
spring.task.execution.pool.queue-capacity=${TASK_EXECUTOR_QUEUE_CAPACITY:100}
spring.task.execution.thread-name-prefix=async-task-
spring.task.scheduling.pool.size=${TASK_SCHEDULING_POOL_SIZE:5}
spring.task.scheduling.thread-name-prefix=scheduled-task-

# Logging Configuration
logging.level.root=${LOG_LEVEL_ROOT:INFO}
logging.level.me.imrashb=${LOG_LEVEL_APP:INFO}
logging.level.org.springframework=${LOG_LEVEL_SPRING:WARN}
logging.level.org.hibernate=${LOG_LEVEL_HIBERNATE:WARN}
logging.level.org.hibernate.SQL=${LOG_LEVEL_SQL:WARN}
logging.level.org.springframework.web=${LOG_LEVEL_WEB:INFO}
logging.pattern.console=${LOG_PATTERN_CONSOLE:%d{yyyy-MM-dd HH:mm:ss} - %msg%n}
logging.pattern.file=${LOG_PATTERN_FILE:%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n}
logging.file.name=${LOG_FILE_PATH:./logs/horaire-ets.log}
logging.file.max-size=${LOG_FILE_MAX_SIZE:10MB}
logging.file.max-history=${LOG_FILE_MAX_HISTORY:30}

# Application Info
info.app.name=HoraireETS API
info.app.version=1.0.0
info.app.description=API for managing course schedules and combinations at École de technologie supérieure (ETS)
info.app.encoding=UTF-8
info.app.java.version=${java.version}
